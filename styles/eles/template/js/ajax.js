!function($){"use strict";phpbb.addAjaxCallback("mark_forums_read",function(res){var readTitle=res.NO_UNREAD_POSTS,unreadTitle=res.UNREAD_POSTS,iconsArray={forum_unread:"forum_read",forum_unread_subforum:"forum_read_subforum",forum_unread_locked:"forum_read_locked"};$("li.row").find('dl[class*="forum_unread"]').each(function(){var $this=$(this);$.each(iconsArray,function(unreadClass,readClass){$this.hasClass(unreadClass)&&$this.removeClass(unreadClass).addClass(readClass)}),$this.children('dt[title="'+unreadTitle+'"]').attr("title",readTitle)}),$('a.subforum[class*="unread"]').removeClass("unread").addClass("read"),$("#active_topics").length&&phpbb.ajaxCallbacks.mark_topics_read.call(this,res,!1),$('[data-ajax="mark_forums_read"]').attr("href",res.U_MARK_FORUMS),phpbb.closeDarkenWrapper(3e3)}),phpbb.addAjaxCallback("mark_topics_read",function(res,updateTopicLinks){var unreadClassSelectors,readTitle=res.NO_UNREAD_POSTS,unreadTitle=res.UNREAD_POSTS,iconsArray={global_unread:"global_read",announce_unread:"announce_read",sticky_unread:"sticky_read",topic_unread:"topic_read"},iconsState=["","_hot","_hot_mine","_locked","_locked_mine","_mine"],classMap={},classNames=[];"undefined"==typeof updateTopicLinks&&(updateTopicLinks=!0),$.each(iconsArray,function(unreadClass,readClass){$.each(iconsState,function(key,value){return"_hot"!==value&&"_hot_mine"!==value||"topic_unread"===unreadClass?(classMap[unreadClass+value]=readClass+value,void classNames.push(unreadClass+value)):!0})}),unreadClassSelectors="."+classNames.join(",."),$("li.row").find(unreadClassSelectors).each(function(){var $this=$(this);$.each(classMap,function(unreadClass,readClass){$this.hasClass(unreadClass)&&$this.removeClass(unreadClass).addClass(readClass)}),$this.children('dt[title="'+unreadTitle+'"]').attr("title",readTitle)}),$("a").has("span.icon_topic_newest").remove(),updateTopicLinks&&$('[data-ajax="mark_topics_read"]').attr("href",res.U_MARK_TOPICS),phpbb.closeDarkenWrapper(3e3)}),phpbb.addAjaxCallback("notification.mark_all_read",function(res){"undefined"!=typeof res.success&&(phpbb.markNotifications($("#notification_list li.bg2"),0),phpbb.closeDarkenWrapper(3e3))}),phpbb.addAjaxCallback("notification.mark_read",function(res){if("undefined"!=typeof res.success){var unreadCount=Number($("#notification_list_button strong").html())-1;phpbb.markNotifications($(this).parent("li.bg2"),unreadCount)}}),phpbb.markNotifications=function($popup,unreadCount){$popup.removeClass("bg2"),$popup.find("a.mark_read").remove(),$popup.each(function(){var link=$(this).find("a");link.attr("href",link.attr("data-real-url"))}),$("strong","#notification_list_button").html(unreadCount),unreadCount||$("#mark_all_notifications").remove();var $title=$("title"),originalTitle=$title.text().replace(/(\((\d+)\))/,"");$title.text((unreadCount?"("+unreadCount+")":"")+originalTitle)},phpbb.addAjaxCallback("post_delete",function(){var postId,$this=$(this);if(void 0===$this.attr("data-refresh")){postId=$this[0].href.split("&p=")[1];var post=$this.parents("#p"+postId).css("pointer-events","none");if(post.hasClass("bg1")||post.hasClass("bg2")){var posts1=post.nextAll(".bg1");post.nextAll(".bg2").removeClass("bg2").addClass("bg1"),posts1.removeClass("bg1").addClass("bg2")}post.fadeOut(function(){$(this).remove()})}}),phpbb.addAjaxCallback("post_visibility",function(res){var remove=res.visible?$(this):$(this).parents(".post");$(remove).css("pointer-events","none").fadeOut(function(){$(this).remove()}),res.visible&&remove.parents(".post").find(".post_deleted_msg").css("pointer-events","none").fadeOut(function(){$(this).remove()})}),phpbb.addAjaxCallback("row_delete",function(){$(this).parents("tr").remove()}),phpbb.addAjaxCallback("zebra",function(res){var zebra;res.success&&(zebra=$(".zebra"),zebra.first().html(res.MESSAGE_TEXT),zebra.not(":first").html("&nbsp;").prev().html("&nbsp;"))}),phpbb.addAjaxCallback("vote_poll",function(res){if("undefined"!=typeof res.success){var poll=$(".topic_poll"),panel=poll.find(".panel"),resultsVisible=poll.find("dl:first-child .resultbar").is(":visible"),mostVotes=0,updatePanelHeight=function(height){height="undefined"==typeof height?panel.find(".inner").outerHeight():height,panel.css("min-height",height)};updatePanelHeight(),resultsVisible||poll.find(".poll_view_results").hide(500),res.can_vote?poll.find(".resultbar, .poll_option_percent, .poll_total_votes").show(500):poll.find(".polls, .poll_max_votes, .poll_vote, .poll_option_select").fadeOut(500,function(){poll.find(".resultbar, .poll_option_percent, .poll_total_votes").show()}),poll.find("[data-poll-option-id]").each(function(){var option=$(this),optionId=option.attr("data-poll-option-id");mostVotes=res.vote_counts[optionId]>=mostVotes?res.vote_counts[optionId]:mostVotes}),poll.find(".poll_total_vote_cnt").html(res.total_votes),poll.find("[data-poll-option-id]").each(function(){var altText,$this=$(this),optionId=$this.attr("data-poll-option-id"),voted="undefined"!=typeof res.user_votes[optionId],mostVoted=res.vote_counts[optionId]===mostVotes,percent=res.total_votes?Math.round(res.vote_counts[optionId]/res.total_votes*100):0,percentRel=0===mostVotes?0:Math.round(res.vote_counts[optionId]/mostVotes*100);altText=$this.attr("data-alt-text"),voted?$this.attr("title",$.trim(altText)):$this.attr("title",""),$this.toggleClass("voted",voted),$this.toggleClass("most-votes",mostVoted);var bar=$this.find(".resultbar div"),barTimeLapse=res.can_vote?500:1500,newBarClass=100===percent?"pollbar5":"pollbar"+(Math.floor(percent/20)+1);setTimeout(function(){bar.animate({width:percentRel+"%"},500).removeClass("pollbar1 pollbar2 pollbar3 pollbar4 pollbar5").addClass(newBarClass).html(res.vote_counts[optionId]);var percentText=percent?percent+"%":res.NO_VOTES;$this.find(".poll_option_percent").html(percentText)},barTimeLapse)}),res.can_vote||poll.find(".polls").delay(400).fadeIn(500);var confirmationDelay=res.can_vote?300:900;poll.find(".vote-submitted").delay(confirmationDelay).slideDown(200,function(){resultsVisible&&updatePanelHeight(),$(this).delay(5e3).fadeOut(500,function(){resizePanel(300)})}),setTimeout(function(){resizePanel(500)},1500);var resizePanel=function(time){var panelHeight=panel.height(),innerHeight=panel.find(".inner").outerHeight();panelHeight!==innerHeight&&panel.css({minHeight:"",height:panelHeight}).animate({height:innerHeight},time,function(){panel.css({minHeight:innerHeight,height:""})})}}}),$(".poll_view_results a").click(function(e){e.preventDefault();var $poll=$(this).parents(".topic_poll");$poll.find(".resultbar, .poll_option_percent, .poll_total_votes").show(500),$poll.find(".poll_view_results").hide(500)}),$("[data-ajax]").each(function(){var $this=$(this),ajax=$this.attr("data-ajax"),filter=$this.attr("data-filter");if("false"!==ajax){var fn="true"!==ajax?ajax:null;filter=void 0!==filter?phpbb.getFunctionByName(filter):null,phpbb.ajaxify({selector:this,refresh:void 0!==$this.attr("data-refresh"),filter:filter,callback:fn})}}),$("#qr_full_editor").click(function(){$("#qr_postform").attr("action",function(i,val){return val+"#preview"})}),$(".display_post").click(function(e){e.preventDefault();var postId=$(this).attr("data-post-id");$("#post_content"+postId).show(),$("#profile"+postId).show(),$("#post_hidden"+postId).hide()}),$("#member_search").click(function(){var $memberlistSearch=$("#memberlist_search");return $memberlistSearch.slideToggle("fast"),phpbb.ajaxCallbacks.alt_text.call(this),$memberlistSearch.is(":visible")&&$("#username").focus(),!1}),$(function(){$("textarea:not(#message-box textarea, .no-auto-resize)")})}(jQuery);