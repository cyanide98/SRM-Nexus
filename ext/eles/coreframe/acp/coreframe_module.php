<?php
namespace eles\coreframe\acp; class coreframe_module { protected $cache; protected $config; protected $config_text; protected $db; protected $log; protected $request; protected $template; protected $user; protected $phpbb_root_path; protected $php_ext; public $u_action; public function main($spd64625, $spc720f9) { global $cache, $config, $db, $phpbb_log, $request, $template, $user, $phpbb_root_path, $phpEx, $phpbb_container; $this->cache = $cache; $this->config = $config; $this->config_text = $phpbb_container->get('config_text'); $this->db = $db; $this->log = $phpbb_log; $this->request = $request; $this->template = $template; $this->user = $user; $this->phpbb_root_path = $phpbb_root_path; $this->php_ext = $phpEx; switch ($spc720f9) { case 'general': break; case 'ads': break; case 'menus': break; case 'style': break; case 'template': break; case 'widgets': break; } $this->page_title = 'C_ACP_' . strtoupper($spc720f9); $this->tpl_name = "mode-{$spc720f9}"; $sp17b13d = (require __DIR__ . '/../inc/cfg/opts.php'); $spa29eac = 'coreframe_opts'; add_form_key($spa29eac); $spbe2fc9 = ''; if ($this->request->is_set_post('submit')) { if (!check_form_key($spa29eac)) { $spbe2fc9 = $this->user->lang('FORM_INVALID'); } $spb68d14 = array(); foreach (array_keys($sp17b13d) as $sp1c09b9) { if ($this->request->is_set($sp1c09b9)) { $spb68d14[$sp1c09b9] = $this->request->variable($sp1c09b9, '', true); } } if (empty($spbe2fc9)) { foreach ($spb68d14 as $sp1c09b9 => $sp094426) { if ('config_text' === $sp17b13d[$sp1c09b9]) { $this->config_text->set($sp1c09b9, $sp094426); } else { $this->config->set($sp1c09b9, $sp094426); } } if ('general' === $spc720f9) { $sped13d0 = array(); $sp2cf992 = $this->request->get_super_global(); $sped13d0 = $sp2cf992['c_sidebar_pages']; $this->config_text->set('c_sidebar_pages', base64_encode(json_encode($sped13d0))); } if ('menus' === $spc720f9) { $sp7560ca = array(); $sp2cf992 = $this->request->get_super_global(); foreach ($sp2cf992 as $sp66f00e => $sp7d9e51) { if (strpos($sp66f00e, 'menu_item_text')) { foreach ($sp7d9e51 as $sp64e749 => $sp094426) { if (!empty($sp094426)) { $sp7560ca[$sp64e749]['text'] = $sp094426; $sp7560ca[$sp64e749]['href'] = $sp2cf992['c_menu_item_href'][$sp64e749]; } } } } $sp7560ca = $sp7560ca ? base64_encode(json_encode($sp7560ca)) : ''; $this->config_text->set('c_menu_items', $sp7560ca); $sp30fc4f = array(); $sp2cf992 = $this->request->get_super_global(); $sp30fc4f = $sp2cf992['c_social_links']; $this->config_text->set('c_social_links', base64_encode(json_encode($sp30fc4f))); } if ('style' === $spc720f9) { $spbd91f1 = array(); $sp2cf992 = $this->request->get_super_global(); $spbd91f1 = $sp2cf992['c_style_vars']; $this->config_text->set('c_style_vars', base64_encode(json_encode($spbd91f1))); } if ('template' === $spc720f9) { $sp460a55 = array(); $sp2cf992 = $this->request->get_super_global(); $sp460a55 = $sp2cf992['c_sidebar_widgets']; $spaafea1 = $sp2cf992['c_footer_widgets']; $this->config_text->set('c_sidebar_widgets', base64_encode(json_encode($sp460a55))); $this->config_text->set('c_footer_widgets', base64_encode(json_encode($spaafea1))); } $this->log->add('admin', $this->user->data['user_id'], $this->user->ip, 'C_ACP_LOG'); $this->cache->destroy('_coreframe_data'); trigger_error($this->user->lang('C_UPDATED') . adm_back_link($this->u_action)); } } $sp598905 = array(); $sp0c3323 = $this->config_text->get_array(array_keys($sp17b13d)); $spbd91f1 = json_decode(base64_decode($this->config_text->get('c_style_vars')), true); if ($spbd91f1) { foreach ($spbd91f1 as $sp66f00e => $sp094426) { $sp598905['C_STYLE_VARS_' . strtoupper($sp66f00e)] = $sp094426; } } $sped13d0 = json_decode(base64_decode($this->config_text->get('c_sidebar_pages')), true); $sp0c3323['c_sidebar_pages'] = $sped13d0; foreach ($sp17b13d as $sp1c09b9 => $sp13be1a) { if ('config_text' === $sp13be1a) { $sp598905[strtoupper($sp1c09b9)] = $sp0c3323[$sp1c09b9]; } else { $sp598905[strtoupper($sp1c09b9)] = $this->config[$sp1c09b9]; } } $this->template->assign_vars(array_merge($sp598905, array('ERRORS' => $spbe2fc9, 'C_ACP_ON' => true, 'U_ACTION' => $this->u_action))); } }